#include <iostream>
#include <robot_instr.h>
#include <robot_link.h>
#include <robot_delay.h>
#include <stopwatch.h>

#define ROBOT_NUM 2
#define DEBUG //If defined all of the print code will run, otherwise it won't

robot_link rlink;
int main()
{
#ifndef __arm__
	if(!rlink.initialise(ROBOT_NUM))
	{
	    std::cout << "Can't find robit" << std::endl;
	    return -1;
	}    
#else
	if(!rlink.initialise())
	{
	    //Pray to your local diety
	    
	    return -1;
	}
#endif
#ifdef DEBUG    
	std::cout << "Successful Connection" << std::endl;
#endif

	int val;
	stopwatch sw;

	sw.start();
	rlink.command(WRITE_PORT_3, 255);
	val = rlink.request(READ_PORT_3);
	int time = sw.read();
	std::cout << "Time Taken to read sensor:" << time << std::endl;
	std::cout << "Value read was: " << val << std::endl;
	std::cout << "Total Time:" << sw.stop() << std::endl;

	std::cout << "Doing Motor stuff" << std::endl;
	rlink.command(MOTOR_1_GO, 63);
	delay(5000);
	rlink.command(MOTOR_1_GO, 0);
	return 0;
	/*if(val == TEST_INSTRUCTION_RESULT)
	{
	    std::cout << "test passed" << std::endl;
	    return 0;
	}
	else if(val == REQUEST_ERROR)
	{
	    std::cout << "Fatal errors on link:" << std::endl;
	    rlink.print_errs();
	}
	else
	    std::cout << "test failed some weird way" << std::endl;
	    return -1; */
 
}
